<template>
  <div class="sign-body bg-white choose-module">
    <p>Please Select Modules</p>
    <div class="module-box">
      <div class="row big-row justify-content-center">
        <!-- <div class="col-md-4">
          <div class="dflex">
            <svg
              id="Layer_1"
              class="pm-icon blue"
              style="height: 40px"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              viewBox="0 0 18 18"
              xml:space="preserve"
            >
              <g id="Group_4066" transform="translate(-332.715 -71.733)">
                <path
                  id="Path_3158"
                  class="fill-color"
                  d="M349.7,73.7c-0.5,0-1-0.4-1-1c0-0.5,0.4-1,1-1c0.3,0,0.5,0.1,0.7,0.3c0.4,0.4,0.4,1,0,1.4C350.2,73.6,350,73.7,349.7,73.7z"
                ></path>
                <path
                  id="Path_3159"
                  class="fill-color"
                  d="M349.7,89.7c-0.5,0-1-0.4-1-1c0,0,0,0,0,0c0-0.5,0.4-1,1-1c0.5,0,1,0.4,1,1S350.3,89.7,349.7,89.7C349.7,89.7,349.7,89.7,349.7,89.7z"
                ></path>
                <path
                  id="Path_3160"
                  class="fill-color"
                  d="M341.7,89.7c-0.5,0-1-0.4-1-1v-0.3v-6.8h-6.4l-0.6,0c-0.5,0-1-0.4-1-1c0-0.3,0.1-0.5,0.3-0.7c0.2-0.2,0.4-0.3,0.7-0.3h7.1v-6.4h0l0-0.7c0-0.5,0.4-1,1-1c0.5,0,1,0.4,1,1v7.1h7c0.3,0,0.5,0.1,0.7,0.3c0.4,0.4,0.4,1,0,1.4c-0.2,0.2-0.4,0.3-0.7,0.3l-0.6,0v0h-6.4v6.9l0,0.2C342.7,89.3,342.2,89.7,341.7,89.7C341.7,89.7,341.7,89.7,341.7,89.7L341.7,89.7z"
                ></path>
                <path
                  id="Path_3161"
                  class="fill-color"
                  d="M333.7,73.7c-0.5,0-1-0.4-1-1s0.4-1,1-1c0.5,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C334.2,73.6,333.9,73.7,333.7,73.7z"
                ></path>
                <path
                  id="Path_3162"
                  class="fill-color"
                  d="M333.7,89.7c-0.5,0-1-0.4-1-1c0-0.5,0.4-1,1-1c0.3,0,0.5,0.1,0.7,0.3c0.4,0.4,0.4,1,0,1.4c0,0,0,0,0,0C334.2,89.6,333.9,89.7,333.7,89.7z"
                ></path>
              </g>
            </svg>
          </div>
          <label class="check-label"
            >Projects
            <input
              v-model="selectedModules"
              type="checkbox"
              value="1"
              data-lpignore="true"
            />
            <span class="check-span"></span>
          </label>
        </div> -->
        <div class="col-md-4">
          <div class="dflex">
            <svg
              id="Layer_1"
              class="dam-icon blue"
              style="height: 40px"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              viewBox="0 0 18 18"
              xml:space="preserve"
            >
              <g id="Group_4069" transform="translate(-332.448 -126.134)">
                <path
                  id="Path_3348"
                  class="fill-color"
                  d="M350.2,126.4c-0.2-0.2-0.4-0.3-0.7-0.3h-16.1c-0.5,0-1,0.4-1,1v0v16.1c0,0.5,0.4,1,1,1h16.1c0.5,0,1-0.4,1-1c0,0,0,0,0,0v-16.1C350.4,126.8,350.3,126.6,350.2,126.4z M348.5,142.2h-14.1v-14.1h14.1L348.5,142.2z"
                ></path>
                <path
                  id="Path_3349"
                  class="fill-color"
                  d="M341.4,136.1c0.3,0,0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4c-0.2-0.2-0.4-0.3-0.7-0.3c-0.3,0-0.5,0.1-0.7,0.3c-0.4,0.4-0.4,1,0,1.4C340.9,136,341.2,136.1,341.4,136.1z"
                ></path>
              </g>
            </svg>
          </div>
          <label class="check-label"
            >Digital Assets Management
            <input
              v-model="selectedModules"
              type="checkbox"
              value="2"
              data-lpignore="true"
            />
            <span class="check-span"></span>
          </label>
        </div>
        <!-- <div class="col-md-4">
          <div class="dflex">
            <svg
              id="Layer_1"
              class="lm-icon blue"
              style="height: 40px"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              viewBox="0 0 18 18"
              xml:space="preserve"
            >
              <g id="Group_4068" transform="translate(-332.463 -96.555)">
                <path
                  id="Path_3342"
                  class="fill-color"
                  d="M349.5,114.6c-0.5,0-1-0.4-1-1c0-0.5,0.4-1,1-1c0.5,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C350,114.5,349.7,114.6,349.5,114.6z"
                ></path>
                <path
                  id="Path_3343"
                  class="fill-color"
                  d="M341.4,98.5c-0.5,0-1-0.4-1-1c0-0.5,0.4-1,1-1c0.5,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C342,98.4,341.7,98.5,341.4,98.5z"
                ></path>
                <path
                  id="Path_3344"
                  class="fill-color"
                  d="M333.4,98.5c-0.5,0-1-0.4-1-1c0-0.5,0.4-1,1-1c0.5,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C333.9,98.4,333.7,98.5,333.4,98.5z"
                ></path>
                <path
                  id="Path_3345"
                  class="fill-color"
                  d="M333.4,106.5c-0.5,0-1-0.4-1-1c0-0.5,0.4-1,1-1c0.5,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C333.9,106.4,333.7,106.5,333.4,106.5z"
                ></path>
                <path
                  id="Path_3346"
                  class="fill-color"
                  d="M333.4,114.6c-0.5,0-1-0.4-1-1c0-0.3,0.1-0.5,0.3-0.7l16-16.1c0.4-0.4,1-0.4,1.4,0c0.4,0.4,0.4,1,0,1.4l-16,16.1C333.9,114.5,333.7,114.6,333.4,114.6z"
                ></path>
                <path
                  id="Path_3347"
                  class="fill-color"
                  d="M341.4,114.6c-0.5,0-1-0.4-1-1c0-0.3,0.1-0.5,0.3-0.7l8-8c0.4-0.4,1-0.4,1.4,0c0.4,0.4,0.4,1,0,1.4l0,0l-8,8C342,114.5,341.7,114.6,341.4,114.6z"
                ></path>
              </g>
            </svg>
          </div>
          <label class="check-label"
            >Lead Management
            <input
              v-model="selectedModules"
              type="checkbox"
              value="3"
              data-lpignore="true"
            />
            <span class="check-span"></span>
          </label>
        </div> -->
      </div>
    </div>
    <div v-if="enableButton" class="row">
      <div class="col-sm-12 text-center">
        <button
          type="submit"
          :class="{
            'cs-btn-orange btn-block btn-spiner': true,
            'btn-disable': loading,
          }"
          :disabled="loading"
          @click="handleSubmit"
        >
          <i v-if="loading" class="fa fa-circle-o-notch fa-spin"></i>
          Submit
        </button>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  layout: 'outerLayout',
  middleware: ['authCheck', 'checkWorkspace', 'check-workspace-modules'],
  data() {
    return {
      workspace_id: this.$route.params.workspace_id
        ? this.$route.params.workspace_id
        : this.$auth.$storage.getCookie('currentWorkspace').id,
      loading: false,
      selectedModules: [],
    }
  },
  computed: {
    enableButton() {
      return !!this.selectedModules.length
    },
  },
  mounted() {
    this.$store.dispatch('dam/setBranding', {
      workspace_id: this.workspace_id,
      isSetFavicon: true,
    })
  },
  methods: {
    async handleSubmit() {
      try {
        this.loading = true
        await this.$axios.$post('add-module-workspace', {
          workspace_id: this.workspace_id,
          module_id: this.selectedModules,
        })

        // Force re-fetch user using active strategy.
        await this.$auth.fetchUser()

        const workspaceId = this.$auth.user.workspace_id
        // set current workspace
        this.$auth.user.workspace_id && this.$setCurrentWorkspace(workspaceId)
        if (this.$_auth().user.redirectPathName === 'workspace_id-dam') {
          if (!Object.keys(this.$store.state.dam.damInstance).length) {
            return this.$router.replace({
              name: 'workspace_id-create-dam-instance',
              params: { workspace_id: this.$_auth().id },
            })
          }
        }
        return this.$router.replace({
          name: this.$_auth().user.redirectPathName,
          params: { workspace_id: this.$_auth().id },
        })
      } catch (e) {
        this.$toast.error(this.$getErrorMessage(e))
        this.loading = false
      }
    },
  },
}
</script>
